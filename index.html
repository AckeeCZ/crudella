<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Crudella</title>
	<meta name="description" content="Documentation for Crudella">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">Crudella</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="globals.html">Globals</a>
				</li>
			</ul>
			<h1>Crudella</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<div align="center">
					<p><img src="https://i.imgur.com/AgRQLRT.png" alt="Crudella">
						<a href="https://travis-ci.com/AckeeCZ/crudella"><img src="https://img.shields.io/travis/com/AckeeCZ/crudella/master.svg?style=flat-square" alt="Build Status"></a>
						<a href="https://coveralls.io/github/AckeeCZ/crudella?branch=master"><img src="https://img.shields.io/coveralls/github/AckeeCZ/crudella.svg?style=flat-square" alt="Coverage Status"></a>
						<a href="https://david-dm.org/AckeeCZ/crudella"><img src="https://img.shields.io/david/AckeeCZ/crudella.svg?style=flat-square" alt="Dependency Status"></a>
						<a href="https://www.npmjs.com/package/crudella"><img src="https://img.shields.io/npm/v/crudella.svg?style=flat-square" alt="Npm"></a>
						<a href="https://www.npmjs.com/package/crudella"><img src="https://img.shields.io/npm/types/crudella.svg?style=flat-square" alt="Types"></a>
						<a href="https://github.com/prettier/prettier"><img src="https://img.shields.io/badge/code_style-prettier-ff69b4.svg?style=flat-square" alt="Prettier"></a>
						<a href="https://ackeecz.github.io/crudella"><img src="https://img.shields.io/badge/docs-typedoc-lightgrey.svg?style=flat-square" alt="Docs"></a>
					<a href="https://github.com/AckeeCZ/crudella/blob/master/LICENSE"><img src="https://img.shields.io/github/license/AckeeCZ/crudella.svg?style=flat-square" alt="License"></a></p>
					<p>Tool for developing generic service layer for RESTful CRUD API in your Node.js backend application.</p>
					<img src="https://www.publicdomainpictures.net/pictures/270000/velka/dog-paint-splatter-illustration.jpg" height="170" width="170"/>
				</div>
				<a href="#crudella" id="crudella" style="color: inherit; text-decoration: none;">
					<h1>Crudella</h1>
				</a>
				<a href="#why-crudella" id="why-crudella" style="color: inherit; text-decoration: none;">
					<h2>Why Crudella</h2>
				</a>
				<p>Crudella is a service factory. It <em>creates</em> your service module based on the minimal required configuration you provide.
					Assume you have an entity repository (or any other CRUD interface for resource) and to make it work, you cannot simply bind it to routes, skipping through controller and service layer.
				Here are several random problems you face in the mentioned layers:</p>
				<ul>
					<li>User authorization</li>
					<li>Request validation (this resource cannot be deleted, only some attributes can be updated etc.)</li>
					<li>Data transformation (before creating or updating resource)</li>
					<li>Verify that resource exists before update or delete</li>
					<li>Pass custom HTTP context to the validation functions</li>
				</ul>
				<p>Crudella implements logic equivalent of the controller and the service layer.
				It goes as far as possible to help you with menial repeated code, but hopefully not as much as to completely take over your application and magically orchestrate behind your back.</p>
				<p>Crudella helps you in various ways:</p>
				<ul>
					<li>Remove lot of boilerplate code: This not only saves you work, but also gives you space to focus on the non-generic code.</li>
					<li>Simplifies testing: Don&#39;t waste your time on running lengthy integration tests for boring CRUD over and over again. Test business logic, not boilerplate.</li>
					<li>Separation of concerns: Do not mix your service logic with validation or authorization. Crudella encourages you to decouple your service logic from client validation and orchestrates the calls for you.</li>
				</ul>
				<a href="#usage" id="usage" style="color: inherit; text-decoration: none;">
					<h2>Usage</h2>
				</a>
				<p>Install via npm:</p>
				<pre><code><span class="hljs-built_in">npm</span> i crudella</code></pre>
				<p>Crudella is tested on several major Node.js <a href="https://travis-ci.com/AckeeCZ/crudella">versions</a> starting at 6.</p>
				<a href="#getting-started" id="getting-started" style="color: inherit; text-decoration: none;">
					<h2>Getting started</h2>
				</a>
				<pre><code class="language-typescript"><span class="hljs-comment">// dalmatianService.ts</span>
<span class="hljs-keyword">import</span> { createService } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;crudella&#x27;</span>;

<span class="hljs-keyword">const</span> dalmatianService = createService&lt;DalmatianAttributes&gt;({
    <span class="hljs-comment">// each method receives relevant CRUD context</span>
    detail: <span class="hljs-function"><span class="hljs-params">ctx</span> =&gt;</span> dalmatianRepository.find(ctx.id, ctx.options),
    create: <span class="hljs-function"><span class="hljs-params">ctx</span> =&gt;</span> dalmatianRepository.create(ctx.data, ctx.options),
    update: <span class="hljs-function"><span class="hljs-params">ctx</span> =&gt;</span> dalmatianRepository.updateById(ctx.entity.id, ctx.data, ctx.options),
    <span class="hljs-keyword">delete</span>: <span class="hljs-function"><span class="hljs-params">ctx</span> =&gt;</span> dalmatianRepository.deleteById(ctx.entity.id),
    list: <span class="hljs-function"><span class="hljs-params">ctx</span> =&gt;</span> dalmatianRepository.list(ctx.filters, ctx.options),
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createPupperMiddleware = dalmatianService.createMiddleware;</code></pre>
				<p>Based on that Crudella provides an express middleware you can use without further hassle:</p>
				<pre><code class="language-typescript"><span class="hljs-comment">// routes.ts</span>
<span class="hljs-keyword">import</span> { createPupperMiddleware } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;dalmatianService&#x27;</span>;

<span class="hljs-keyword">const</span> router = createRouter();
router.use(createPupperMiddleware(<span class="hljs-string">&#x27;/api/puppies&#x27;</span>))</code></pre>
				<p>That saved us some time. We don&#39;t have to bind the routes ourselves.
				More importantly though, we can control the flow using rich contextual data. See <a href="#authorization">authorization</a>.</p>
				<p>:information_source: Not using express? You can still use Crudella. See <a href="./guide/handlers.md">generating handlers</a>.</p>
				<p>:information_source: This definition still feels too long and you have consistent repository API? See <a href="./guide/repository.md">configuring crudella using repository</a>.</p>
				<a href="#advanced-topics" id="advanced-topics" style="color: inherit; text-decoration: none;">
					<h2>Advanced topics</h2>
				</a>
				<a href="#authorization" id="authorization" style="color: inherit; text-decoration: none;">
					<h3>Authorization</h3>
				</a>
				<p>Crudella allows you to decouple pure data manipulation (persisting puppies) from request verification.
				Use <code>authorize</code> option with rich contextual data to reject access due to validation / authorization and do not pollute logic of manipulating objects with unrelated code.</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { Access, createService } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;crudella&#x27;</span>;

<span class="hljs-keyword">const</span> dalmatianService = createService&lt;DalmatianAttributes&gt;({
    <span class="hljs-comment">// ...all crud methods</span>
    authorize: <span class="hljs-keyword">async</span> ctx =&gt; {
        <span class="hljs-comment">// reject anonymous users for all actions (detail, create, update, delete, list)</span>
        <span class="hljs-comment">// ctx.context is type of C, which you can set for your application</span>
        <span class="hljs-keyword">if</span> (!ctx.context.user) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;Anonymous cannot see, delete, update or create dalmatians&#x27;</span>)
        }
        <span class="hljs-comment">// reject for selected operations</span>
        <span class="hljs-keyword">if</span> (ctx.type === Access.LIST &amp;&amp; <span class="hljs-string">&#x27;dots&#x27;</span> <span class="hljs-keyword">in</span> filters) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;Is rude to filter using dots!&#x27;</span>)
        }
        <span class="hljs-keyword">if</span> (ctx.type === Access.CREATE &amp;&amp; !isValidPuppy(ctx.data)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;Your puppy is invalid, sorry.&#x27;</span>)
        }
        <span class="hljs-comment">// ctx contains all you need for validation and authorization</span>
        <span class="hljs-keyword">if</span> (ctx.type === Access.UPDATE) {
            <span class="hljs-keyword">if</span> (!age <span class="hljs-keyword">in</span> ctx.bareData) { <span class="hljs-comment">// only data sent by client</span>
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;Age missing on update&#x27;</span>)
            }
            <span class="hljs-keyword">if</span> (!isValidPuppy(ctx.data)) { <span class="hljs-comment">// new data defaulted to existing entity</span>
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;Validation failed&#x27;</span>)
            }
        }
    },
});</code></pre>
				<p>For full reference of the contexts, see <a href="https://ackeecz.github.io/crudella/interfaces/basecrudcontext.html">API docs</a>.</p>
				<a href="#other-topics" id="other-topics" style="color: inherit; text-decoration: none;">
					<h3>Other topics</h3>
				</a>
				<ul>
					<li><a href="./guide/data-transformation.md">Data transformation</a></li>
					<li><a href="./guide/repository.md">Configuring crudella using repository</a></li>
					<li><a href="./guide/handlers.md">Generating handlers</a></li>
					<li><a href="./guide/builder.md">Service builder and custom context</a></li>
					<li>:construction: Dynamic options</li>
					<li><a href="./guide/notfound.md">Custom 404 error</a></li>
					<li><a href="./guide/controller-flow.md">Customizing controller flow</a></li>
				</ul>
				<a href="#development" id="development" style="color: inherit; text-decoration: none;">
					<h2>Development</h2>
				</a>
				<a href="#building" id="building" style="color: inherit; text-decoration: none;">
					<h4>Building</h4>
				</a>
				<p>Run <code>npm run build</code> to compile Typescript into JavaScript.</p>
				<a href="#testing" id="testing" style="color: inherit; text-decoration: none;">
					<h4>Testing</h4>
				</a>
				<p>Project uses <a href="https://jestjs.io">Jest</a> testing framework and its snapshot testing.
				Run <code>npm run test</code> to test or <code>npm run test:coverage</code> to collect coverage.</p>
				<p><a href="https://travis-ci.com/AckeeCZ/crudella">Travis CI</a> tests PRs, <a href="https://coveralls.io/github/AckeeCZ/crudella?branch=master">Coveralls</a> collect coverage.</p>
				<a href="#coding-style" id="coding-style" style="color: inherit; text-decoration: none;">
					<h4>Coding style</h4>
				</a>
				<p>TS lint and prettier
				<code>npm run lint</code></p>
				<a href="#docs" id="docs" style="color: inherit; text-decoration: none;">
					<h4>Docs</h4>
				</a>
				<p>To generate API docs using <a href="https://typedoc.org/">TypeDoc</a> and preview locally, run <code>npm run docs</code>.
					Output is an ignored <code>docs</code> folder.
				Current API documentation is deployed by Travis via <a href="https://pages.github.com/">GitHub Pages</a> :octocat:</p>
				<a href="#license" id="license" style="color: inherit; text-decoration: none;">
					<h2>License</h2>
				</a>
				<p>This project is licensed under <a href="./LICENSE">MIT</a>.</p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="globals  ">
						<a href="globals.html"><em>Globals</em></a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
					<li class=" tsd-kind-enum">
						<a href="enums/operation.html" class="tsd-kind-icon">Operation</a>
					</li>
					<li class=" tsd-kind-interface tsd-has-type-parameter">
						<a href="interfaces/basecrudcontext.html" class="tsd-kind-icon">Base<wbr>Crud<wbr>Context</a>
					</li>
					<li class=" tsd-kind-interface tsd-has-type-parameter">
						<a href="interfaces/createcontext.html" class="tsd-kind-icon">Create<wbr>Context</a>
					</li>
					<li class=" tsd-kind-interface tsd-has-type-parameter">
						<a href="interfaces/crudcontroller.html" class="tsd-kind-icon">Crud<wbr>Controller</a>
					</li>
					<li class=" tsd-kind-interface tsd-has-type-parameter">
						<a href="interfaces/crudrepository.html" class="tsd-kind-icon">Crud<wbr>Repository</a>
					</li>
					<li class=" tsd-kind-interface tsd-has-type-parameter">
						<a href="interfaces/definitions.html" class="tsd-kind-icon">Definitions</a>
					</li>
					<li class=" tsd-kind-interface tsd-has-type-parameter">
						<a href="interfaces/deletecontext.html" class="tsd-kind-icon">Delete<wbr>Context</a>
					</li>
					<li class=" tsd-kind-interface tsd-has-type-parameter">
						<a href="interfaces/detailcontext.html" class="tsd-kind-icon">Detail<wbr>Context</a>
					</li>
					<li class=" tsd-kind-interface tsd-has-type-parameter">
						<a href="interfaces/handlercreators.html" class="tsd-kind-icon">Handler<wbr>Creators</a>
					</li>
					<li class=" tsd-kind-interface tsd-has-type-parameter">
						<a href="interfaces/listcontext.html" class="tsd-kind-icon">List<wbr>Context</a>
					</li>
					<li class=" tsd-kind-interface tsd-has-type-parameter">
						<a href="interfaces/updatecontext.html" class="tsd-kind-icon">Update<wbr>Context</a>
					</li>
					<li class=" tsd-kind-type-alias tsd-has-type-parameter">
						<a href="globals.html#createhandler" class="tsd-kind-icon">Create<wbr>Handler</a>
					</li>
					<li class=" tsd-kind-type-alias tsd-has-type-parameter">
						<a href="globals.html#crudcontext" class="tsd-kind-icon">Crud<wbr>Context</a>
					</li>
					<li class=" tsd-kind-type-alias tsd-has-type-parameter">
						<a href="globals.html#datacontext" class="tsd-kind-icon">Data<wbr>Context</a>
					</li>
					<li class=" tsd-kind-type-alias tsd-has-type-parameter">
						<a href="globals.html#deletehandler" class="tsd-kind-icon">Delete<wbr>Handler</a>
					</li>
					<li class=" tsd-kind-type-alias tsd-has-type-parameter">
						<a href="globals.html#detailhandler" class="tsd-kind-icon">Detail<wbr>Handler</a>
					</li>
					<li class=" tsd-kind-type-alias tsd-has-type-parameter">
						<a href="globals.html#listhandler" class="tsd-kind-icon">List<wbr>Handler</a>
					</li>
					<li class=" tsd-kind-type-alias tsd-has-type-parameter">
						<a href="globals.html#omit" class="tsd-kind-icon">Omit</a>
					</li>
					<li class=" tsd-kind-type-alias tsd-has-type-parameter">
						<a href="globals.html#serviceimplementation" class="tsd-kind-icon">Service<wbr>Implementation</a>
					</li>
					<li class=" tsd-kind-type-alias tsd-has-type-parameter">
						<a href="globals.html#stripconstants" class="tsd-kind-icon">Strip<wbr>Constants</a>
					</li>
					<li class=" tsd-kind-type-alias tsd-has-type-parameter">
						<a href="globals.html#updatehandler" class="tsd-kind-icon">Update<wbr>Handler</a>
					</li>
					<li class=" tsd-kind-function tsd-has-type-parameter">
						<a href="globals.html#bootstrapconfiguration" class="tsd-kind-icon">bootstrap<wbr>Configuration</a>
					</li>
					<li class=" tsd-kind-function tsd-has-type-parameter">
						<a href="globals.html#buildservice" class="tsd-kind-icon">build<wbr>Service</a>
					</li>
					<li class=" tsd-kind-function tsd-has-type-parameter">
						<a href="globals.html#createdefaultimplementation" class="tsd-kind-icon">create<wbr>Default<wbr>Implementation</a>
					</li>
					<li class=" tsd-kind-function tsd-has-type-parameter">
						<a href="globals.html#createhandlers" class="tsd-kind-icon">create<wbr>Handlers</a>
					</li>
					<li class=" tsd-kind-function tsd-has-type-parameter">
						<a href="globals.html#createmiddlewarefactory" class="tsd-kind-icon">create<wbr>Middleware<wbr>Factory</a>
					</li>
					<li class=" tsd-kind-function tsd-has-type-parameter">
						<a href="globals.html#createrepoimplementation" class="tsd-kind-icon">create<wbr>Repo<wbr>Implementation</a>
					</li>
					<li class=" tsd-kind-function tsd-has-type-parameter">
						<a href="globals.html#createservice" class="tsd-kind-icon">create<wbr>Service</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#errororempty" class="tsd-kind-icon">error<wbr>OrEmpty</a>
					</li>
					<li class=" tsd-kind-function tsd-has-type-parameter">
						<a href="globals.html#forgecreatecontext" class="tsd-kind-icon">forge<wbr>Create<wbr>Context</a>
					</li>
					<li class=" tsd-kind-function tsd-has-type-parameter">
						<a href="globals.html#forgedeletecontext" class="tsd-kind-icon">forge<wbr>Delete<wbr>Context</a>
					</li>
					<li class=" tsd-kind-function tsd-has-type-parameter">
						<a href="globals.html#forgedetailcontext" class="tsd-kind-icon">forge<wbr>Detail<wbr>Context</a>
					</li>
					<li class=" tsd-kind-function tsd-has-type-parameter">
						<a href="globals.html#forgelistcontext" class="tsd-kind-icon">forge<wbr>List<wbr>Context</a>
					</li>
					<li class=" tsd-kind-function tsd-has-type-parameter">
						<a href="globals.html#forgeupdatecontext" class="tsd-kind-icon">forge<wbr>Update<wbr>Context</a>
					</li>
					<li class=" tsd-kind-function tsd-has-type-parameter">
						<a href="globals.html#getdefaultcontroller" class="tsd-kind-icon">get<wbr>Default<wbr>Controller</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>